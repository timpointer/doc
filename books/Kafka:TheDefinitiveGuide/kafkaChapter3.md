

## Kafka Producers
不同的用例暗示了各种各样的需求。

我们开发产生需求前需要创建ProducerRecord

发送消息，分为几个步骤，首先创建ProducerRecord类，然后经过序列化节点将数据序列化二进制格式，在经过分片节点选择对应的分片，最后添加到对应的待发送队列中，由另一个线程去发送消息到kafka的broker。

发送接口很简单，大多数的控制行为在配置阶段就已经设定好。

主要的发送方式有三种，对应不同的错误报告机制。
Fire-and-forget，Synchronous send，Asynchronous send
你可以通过增加线程来提升，在提升写入端性能。

### 顺序保证
一个可靠的系统，都需要设置重试，但重试会导致乱序，为了避免这种情况发生，需要将in.flight.requests.per.session设置为1.这样能确保顺序执行。

### 序列化
可以使用ProtortalBuffer等通用序列化工具来序列化。
可以使用Schema注册中心来注册Schema

### 分片
消息中的Key有两个作用，为消息提供额外信息，和决定数据发送到哪个分片。
当key为Null时，default分片器会被使用。消息被发送随机发送到一个分片中，用的轮训算法。
变更分片数量会导致同样的key被分发到不同的分片上，如果这是一个问题，就应该提前设置好分片数量，再也不变动它。

可以自定义分片器实现来解决热点数据导致某个分片数据量过大的问题。