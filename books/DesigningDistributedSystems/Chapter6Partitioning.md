
# Partitions(sharding)
Partitioning不同系统里面叫法不同，比如shard,region,table,vnode,vBucket，这里统一叫分片。

分片定义了每条数据属于哪个一个分片。有许多不同的分片方式。每个分片就是一个自己的小数据库，虽然数据库可能提供了跨分片的操作。
分片主要目的为了扩展（scalability）。不同的分片分布在不同节点上在一个shared-nothing的集群中。大的数据集合能被放置于不同的磁盘上，请求能被分发到不同的处理器上。

请求能被并行在多个节点上执行。

事务型和分析型数据库在分片上本质是一样的，只是系统调教不同。

我们先看下不同的分片方式和观察数据索引是怎么和分片交互的。然后讨论再平衡，有必要时需要增加和删除节点。最后看下如何路由请求和执行查询。

# Partitioning and Replication
分片和副本是两个独立的概念，可以分开使用也能组合使用。
组合使用的一般场景是，数据集有三个分片，每个分片有三个备份，一主两从。九个分片备份被分布在三个节点上，每个节点上既有主的分片，也有从的分片。

# Partitioning of Key-Value Data
假如你有一个大数据集要分片，如何决定哪条记录在哪个节点上呢？

我们的目标是把数据和请求均匀的分散到不同节点上。理论上１０个节点能处理10倍的数据和10倍的请求。
如果分片不公平，有些分片的数据和请求比其他一些大，称之为"skewed"。当发生偏差时，分片就不够有效了。当请求都集中到一个分片上时被称为"hot spot"

最简单避免热点的方式是随机分片。但这样有一个缺点，就是查询具体一条数据时，需要请求所有节点。
我们能做的更好。假设有一个简单的key-value模型，总是从主键查记录。可以参照百科全书，按照标题排序，你就能快速找到记录。

## 通过key范围分片
一种方法是为一个分片指定一个连续范围的key。如果你知道哪个key属于哪个分片，又知道哪个分片属于哪个节点。就能直接请求具体的节点。

key的范围并不需要平均分布，因为你的数据也不是平均分布的。拿百科全书举例，可能卷1包含A,B开头，卷12包含T,U,V,X,Y和Z。要适应数据本身的特性。
分片可以由管理员手动选择，也能自动选择。

在每个分片中，保持key的排序，好处是方便范围查询。能把key当做组合索引的一部分。
举例，考虑一个时序型应用，拿时间戳作为key来分片，就能很容易查询到一个特定月份的数据。
然而，特定的请求会导致热点。如果按照时间戳分片，一天一个分片，那当天的数据都会写到统一分片中。而其他分片都闲着。

为了避免这个问题，你需要使用时间戳以外的其他元素作为key。比如从感应器的名字加上时间戳来做分片。假设你有许多感应器产生数据，这些请求会被均匀分散。

